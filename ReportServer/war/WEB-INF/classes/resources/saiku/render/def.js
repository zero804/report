/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */

var def=function(){function a(a,b){return q[a]=b}function b(a,b){var c=b||p;if(a){var d=a.split("."),e=d.length;if(e){var f,g=0;if(c===m.global){f=d[0];var h=m.getOwn(q,f);h&&(c=h,g++)}for(;e>g;)f=d[g++],c=c[f]||(c[f]={})}}return c}function c(a,c,d){m.fun.is(c)&&(d=c,c=null);var e=b(a,c);if(d){r.push(p);try{d(e)}finally{p=r.pop()}}return e}function d(a,b,c){return!m.hasOwn(a,b)||m.fail.operationInvalid("Name '{0}' is already defined in namespace.",[b]),a[b]=c}function e(a){return function(b){return f(b,k.call(arguments,1),a)}}function f(a,b,c){for(var d=0,e=b.length;e>d;d++){var f=b[d];f&&(f=m.object.as(f.prototype||f),f&&g(a,f,c))}return a}function g(a,b,c){for(var d in b)h(a,d,b[d],c)}function h(a,b,c,d){if(void 0!==c){var e,f=m.object.asNative(a[b]);f?(e=m.object.as(c),e?(l.call(a,b)||(a[b]=f=Object.create(f)),g(f,e,d)):a[b]=c):(e=m.object.asNative(c),e&&(c=(d||Object.create)(e)),a[b]=c)}}function i(a){for(var b in a){var c=m.object.asNative(a[b]);c&&i(a[b]=Object.create(c))}}function j(){for(;this._source.next();){var a=this._selectMany?this._selectMany.call(this._ctx,this._source.item,this._source.index):this._source.item;if(null!=a)return this._manySource=m.query(a),!0}}var k=Array.prototype.slice;Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),Object.create||(Object.create=function(){function a(a){b.prototype=a||{};var d=new b;return b.prototype=c,d}var b=function(){},c=b.prototype;return a}()),Function.prototype.bind||(Function.prototype.bind=function(a){var b=k.call(arguments,1),c=this;return function(){return c.apply(a,b.concat(k.call(arguments)))}}),this.JSON||(this.JSON={}),this.JSON.stringify||(this.JSON.stringify=function(a){return""+a});var l=Object.prototype.hasOwnProperty,m={global:this,get:function(a,b,c){var d;return a&&null!=(d=a[b])?d:c},gets:function(a,b){return b.map(function(b){return a[b]})},getPath:function(a,b,c,d){if(!a)return c;if(null!=b){var e=m.array.is(b)?b:b.split("."),f=e.length;if(f)for(var g=0;f>g;){var h=e[g++],i=a[h];if(null==i){if(!d)return c;i=a[h]=null==c||isNaN(+c)?{}:[]}a=i}}return a},setPath:function(a,b,c){if(a&&null!=b){var d=m.array.is(b)?b:b.split(".");if(d.length){var e=d.pop();a=m.getPath(a,d,e,!0),null!=a&&(a[e]=c)}}return a},propGet:function(a,b){return a=""+a,function(c){return c?c[a]:b}},getOwn:function(a,b,c){var d;return a&&l.call(a,b)&&null!=(d=a[b])?d:c},hasOwn:function(a,b){return!!a&&l.call(a,b)},hasOwnProp:l,set:function(a){for(var b=a||{},c=arguments,d=1,e=c.length-1;e>d;d+=2)b[c[d]]=c[d+1];return b},setDefaults:function(a,b){var c,d=a||{},e=arguments,f=e.length;if(2===f&&m.object.is(b))for(c in b)null==d[c]&&(d[c]=b[c]);else{f--;for(var g=1;f>g;g+=2)c=e[g],null==d[c]&&(d[c]=e[g+1])}return d},setUDefaults:function(a,b){var c,d=a||{},e=arguments,f=e.length;if(2===f&&m.object.is(b))for(c in b)void 0===d[c]&&(d[c]=b[c]);else{f--;for(var g=1;f>g;g+=2)c=e[g],void 0===d[c]&&(d[c]=e[g+1])}return d},eachOwn:function(a,b,c){if(a)for(var d in a)l.call(a,d)&&b.call(c,a[d],d,a)},each:function(a,b,c){if(a)for(var d in a)b.call(c,a[d],d,a)},copyOwn:function(a,b){var c,d;if(arguments.length>=2?(c=a||{},d=b):(c={},d=a),d)for(var e in d)l.call(d,e)&&(c[e]=d[e]);return c},copy:function(a,b){var c,d;if(arguments.length>=2?(c=a||{},d=b):(c={},d=a),d)for(var e in d)c[e]=d[e];return c},copyProps:function(a,b,c){var d,e;return arguments.length>=3?(d=a||{},e=b):(d={},e=a,c=b),c&&c.forEach(e?function(a){d[a]=e[a]}:function(a){d[a]=void 0}),d},keys:function(a){var b=[];for(var c in a)b.push(c);return b},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},uniqueIndex:function(a,b,c){var d={};for(var e in a){var f=b?b.call(c,a[e]):a[e];null==f||l.call(d,f)||(d[f]=e)}return d},ownKeys:Object.keys,own:function(a,b,c){var d=Object.keys(a);return d.map(b?function(d){return b.call(c,a[d],d)}:function(b){return a[b]})},scope:function(a,b){return a.call(b)},bit:{set:function(a,b,c){return c||null==c?a|b:a&~b}},compare:function(a,b){return a===b?0:a>b?1:-1},compareReverse:function(a,b){return a===b?0:a>b?-1:1},methodCaller:function(a,b){return b?function(){return b[a].apply(b,arguments)}:function(){return this[a].apply(this,arguments)}},identity:function(a){return a},add:function(a,b){return a+b},negate:function(a){return function(){return!a.apply(this,arguments)}},sqr:function(a){return a*a},noop:function(){},retTrue:function(){return!0},retFalse:function(){return!1},number:{is:function(a){return"number"==typeof a},as:function(a,b){var c=parseFloat(a);return isNaN(c)?b||0:c},to:function(a,b){var c=parseFloat(a);return isNaN(c)?b||0:c}},array:{is:function(a){return a instanceof Array},isLike:function(a){return a&&null!=a.length&&"string"!=typeof a},as:function(a){return a instanceof Array?a:null!=a?[a]:null},to:function(a){return a instanceof Array?a:null!=a?[a]:null},lazy:function(a,b,c,d){return a[b]||(a[b]=c?c.call(d,b):[])},copy:function(a){return k.apply(a,k.call(arguments,1))}},object:{is:function(a){return a&&"object"==typeof a},isNative:function(a){return!!a&&a.constructor===Object},as:function(a){return a&&"object"==typeof a?a:null},asNative:function(a){return a&&a.constructor===Object?a:null},lazy:function(a,b,c,d){return a[b]||(a[b]=c?c.call(d,b):{})}},string:{is:function(a){return"string"==typeof a},to:function(a,b){return null!=a?""+a:b||""},join:function(a){var b,c,d=arguments,e=d.length;switch(e){case 3:return b=d[1],c=d[2],null!=b&&""!==b?null!=c&&""!==c?""+b+a+(""+c):""+b:null!=c&&""!==c?""+c:"";case 2:return b=d[1],null!=b?""+b:"";case 1:case 0:return""}for(var f=[],g=1;e>g;g++)b=d[g],null!=b&&""!==b&&f.push(""+b);return f.join(a)},padRight:function(a,b,c){a||(a=""),null==c&&(c=" ");var d=~~((b-a.length)/c.length);return d>0?a+new Array(d+1).join(c):a}},fun:{is:function(a){return"function"==typeof a},as:function(a){return"function"==typeof a?a:null},to:function(a){return"function"==typeof a?a:m.fun.constant(a)},constant:function(a){return function(){return a}}},nullyTo:function(a,b){return null!=a?a:b},between:function(a,b,c){return Math.max(b,Math.min(a,c))},nully:function(a){return null==a},notNully:function(a){return null!=a},notUndef:function(a){return void 0!==a},empty:function(a){return null==a||""===a},notEmpty:function(a){return null!=a&&""!==a},truthy:function(a){return!!a},falsy:function(a){return!a},firstUpperCase:function(a){if(a){var b=a.charAt(0),c=b.toUpperCase();b!==c&&(a=c+a.substr(1))}return a},firstLowerCase:function(a){if(a){var b=a.charAt(0),c=b.toLowerCase();b!==c&&(a=c+a.substr(1))}return a},format:function(a,b,c){if(null==a||""===a)return"";var d=b&&m.fun.is(b);return a.replace(/(^|[^{])\{([^{}]+)\}/g,function(a,e,f){var g=b?d?b.call(c,f):b[f]:null;return e+(null==g?"":String(g))})},destructuringTypeBind:function(a,b){var c=a.length,d=new Array(c);if(c&&b){var e=b.length;if(e){var f=0,g=0;do{var h=b[f];null!=h&&typeof h!==a[g]||(d[g]=h,f++),g++}while(c>g&&e>f)}}return d},error:function(a){return a instanceof Error?a:new Error(a)},fail:function(a){throw m.error(a)},assert:function(a,b){throw m.error.assertionFailed(a,b)}};m.ascending=m.compare,m.descending=m.compareReverse;var n=m.array.like=m.copyOwn(function(a){return n.is(a)?a:[a]},{is:function(a){return a&&null!=a.length&&"string"!=typeof a},as:function(a){return n.is(a)?a:null}});n.to=n,m.lazy=m.object.lazy,m.shared=function(){function a(a){function b(){c=a}return b}function b(a){if(null!=c)throw new Error("Access denied.");a();var b;return b=c,c=null,b}var c=null;return b.safe=a,b};var o={operationInvalid:function(a,b){return m.error(m.string.join(" ","Invalid operation.",m.format(a,b)))},notImplemented:function(){return m.error("Not implemented.")},argumentRequired:function(a){return m.error(m.format("Required argument '{0}'.",[a]))},argumentInvalid:function(a,b,c){return m.error(m.string.join(" ",m.format("Invalid argument '{0}'.",[a]),m.format(b,c)))},assertionFailed:function(a,b){return m.error(m.string.join(" ","Assertion failed.",m.format(a,b)))}};m.copyOwn(m.error,o),m.eachOwn(o,function(a,b){m.fail[b]=function(){throw a.apply(null,arguments)}});var p=m,q={},r=[];m.space=c,m.globalSpace=a,m.mixin=e(Object.create),m.copyOwn(m.mixin,{custom:e,inherit:m.mixin,copy:e(m.copy),share:e(m.identity)}),m.create=function(){var a=k.call(arguments),b=!0,c=a.shift();"boolean"==typeof c&&(b=c,c=a.shift());var d=c?Object.create(c):{};return b&&i(d),a.length>0&&(a.unshift(d),m.mixin.apply(m,a)),d},m.scope(function(){function a(){return m.error.operationInvalid("Type is locked.")}function b(a,b){if(a)do{var c=m.getOwn(a.constructor,b);if(void 0!==c)return c}while(a=a.base)}function c(a){var b;a&&(a instanceof Array?(b=a,a=b.join(".")):b=a.split(".")),b&&b.length>1?(this.name=b.pop(),this.namespace=b.join("."),this.namespaceParts=b):(this.name=a||null,this.namespace=null,this.namespaceParts=[])}function e(a){this.fun=a.as,this.isAbstract=!!a.isAbstract}function f(a){if(a){if(m.fun.is(a))return new e({as:a});if(a instanceof e)return a;if(m.fun.is(a.as))return new e(a);if(a.isAbstract)return new e({isAbstract:!0,as:m.fail.notImplemented})}return null}function g(a){return f(a)||m.fail.argumentInvalid("fun")}function i(){}function j(a,b){return function(){var c=t.base;t.base=b;try{return a.apply(this,arguments)}finally{t.base=c}}}function k(a,b){return this[a]=j(b,this[a]),this}function l(){return""+this.constructor}function n(a,b){var c=a.prototype=Object.create(b.prototype);return c.constructor=a,c}function o(a){function b(){if(c)for(var a=0;d[a].apply(this,arguments)!==!1&&++a<c;);}var c=1,d=[function(){return c=0,a.initOrPost?(d.length=0,a.init&&(d.push(a.init),c++),a.post&&(d.push(a.post),c++),b.apply(this,arguments),!1):void(d=null)}];return b}function p(){var a=m.destructuringTypeBind(v,arguments);return q.apply(this,a)}function q(a,b,e){var f,g=new c(a);b?(f=b.safe&&r(b.safe)||m.fail.operationInvalid('Invalid "foreign" base type.'),f.locked=!0):(b=i,f=u);var h=Object.create(f);h.locked=!1,h.base=f,h.methods=Object.create(f.methods);var j=o(h);m.copyOwn(j,s),j.name=g.name,j.typeName=g,j.safe=r.safe(h),j.toString=function(){return""+this.typeName||"Anonymous type"};var p=n(j,b);return h.constructor=j,p.override=k,p.toString=l,g.name&&d(m.space(g.namespace,e),g.name,j),j}var r=m.shared(),s={init:function(b){b||m.fail.argumentRequired("init");var c=r(this.safe);!c.locked||m.fail(a());var d=c.init;return d&&(b=j(b,d)),c.init=b,c.initOrPost=!0,this},postInit:function(b){b||m.fail.argumentRequired("postInit");var c=r(this.safe);!c.locked||m.fail(a());var d=c.post;return d&&(b=j(b,d)),c.post=b,c.initOrPost=!0,this},add:function(b){var c=r(this.safe);!c.locked||m.fail(a());var d=this.prototype,g=c.base;return m.each(b.prototype||b,function(a,b){switch(b){case"base":case"constructor":return;case"toString":if(a===l)return;break;case"override":if(a===k)return}if(a){var i=f(a);if(i){var j,n=c.methods[b];return n&&n instanceof e?j=n:g&&(n=g.methods[b],n&&n instanceof e&&(j=n)),c.methods[b]=i,j&&(a=j.override(i)),void(d[b]=a)}}h(d,b,a,m.identity)}),this},getStatic:function(a){return b(r(this.safe),a)},addStatic:function(c){var d=r(this.safe);!d.locked||m.fail(a());for(var e in c)if("prototype"!==e){var f=c[e],g=m.object.as(f);if(g){var h=m.getOwn(this,e),i=void 0!==h;i||(h=b(d.base,e));var j=m.object.asNative(h);if(j){if(i){m.mixin(h,f);continue}f=m.create(h,f)}}this[e]=f}return this}};c.prototype.toString=function(){return m.string.join(".",this.namespace+"."+this.name)},m.copyOwn(e.prototype,{override:function(a){if(this.isAbstract)return a.fun;var b=j(a.fun,this.fun);return a.fun=b,b}});var t=i.prototype;t.base=void 0;var u={locked:!0,init:void 0,postInit:void 0,initOrPost:!1,methods:{},constructor:i};i.safe=r.safe(u);var v=["string","function","object"];m.type=p,m.method=g}),m.makeEnum=function(a){var b=1,c={};return a.forEach(function(a){c[a]=b,b<<=1}),c},m.copyOwn(m.array,{create:function(a,b){var c=a>=0?new Array(a):[];if(void 0!==b)for(var d=0;a>d;d++)c[d]=b;return c},append:function(a,b,c){null==c&&(c=0);for(var d=0,e=b.length,f=a.length;e>d;d++)a[f+d]=b[c+d];return a},appendMany:function(a){var b=arguments,c=b.length;if(c>1)for(var d=a.length,e=1;c>e;e++){var f=b[e];if(f)for(var g=0,h=f.length;h>g;)a[d++]=f[g++]}return a},prepend:function(a,b,c){null==c&&(c=0);for(var d=0,e=b.length;e>d;d++)a.unshift(b[c+d]);return a},removeAt:function(a,b){return a.splice(b,1)[0]},insertAt:function(a,b,c){return a.splice(b,0,c),a},removeIf:function(a,b,c){for(var d=0,e=a.length;e>d;)b.call(c,a[d],d)?(e--,a.splice(d,1)):d++;return a},binarySearch:function(a,b,c,d){c||(c=m.compare);for(var e=0,f=a.length-1;f>=e;){var g=e+f>>1,h=c(b,d?d(a[g]):a[g]);if(0>h)f=g-1;else{if(!(h>0))return g;e=g+1}}return~e},insert:function(a,b,c){var d=m.array.binarySearch(a,b,c);return 0>d&&a.splice(~d,0,b),d},remove:function(a,b,c){var d=m.array.binarySearch(a,b,c);return d>=0?a.splice(d,1)[0]:void 0}});var s=1,t={};return m.nextId=function(a){if(a){var b=m.getOwn(t,a)||1;return t[a]=b+1,b}return s++},m.type("Set").init(function(a,b){this.source=a||{},this.count=a?null!=b?b:m.ownKeys(a).length:0}).add({has:function(a){return l.call(this.source,a)},add:function(a){var b=this.source;return l.call(b,a)||(this.count++,b[a]=!0),this},rem:function(a){return l.call(this.source,a)&&(delete this.source[a],this.count--),this},clear:function(){return this.count&&(this.source={},this.count=0),this},members:function(){return m.ownKeys(this.source)}}),m.type("Map").init(function(a,b){this.source=a||{},this.count=a?null!=b?b:m.ownKeys(a).length:0}).add({has:function(a){return l.call(this.source,a)},get:function(a){return l.call(this.source,a)?this.source[a]:void 0},set:function(a,b){var c=this.source;return l.call(c,a)||this.count++,c[a]=b,this},rem:function(a){return l.call(this.source,a)&&(delete this.source[a],this.count--),this},clear:function(){return this.count&&(this.source={},this.count=0),this},copy:function(a){m.eachOwn(a.source,function(a,b){this.set(b,a)},this)},values:function(){return m.own(this.source)},keys:function(){return m.ownKeys(this.source)},clone:function(){return new m.Map(m.copy(this.source),this.count)},symmetricDifference:function(a){if(!this.count)return a.clone();if(!a.count)return this.clone();var b={},c=0,d=this.source,e=a.source;return m.eachOwn(d,function(a,d){l.call(e,d)||(b[d]=a,c++)}),m.eachOwn(e,function(a,e){l.call(d,e)||(b[e]=a,c++)}),new m.Map(b,c)},intersect:function(a,b){return b||(b=new m.Map),m.eachOwn(this.source,function(c,d){a.has(d)&&b.set(d,c)}),b}}),m.type("OrderedMap").init(function(){this._list=[],this._map={}}).add({has:function(a){return l.call(this._map,a)},count:function(){return this._list.length},get:function(a){var b=this._map;return l.call(b,a)?b[a].value:void 0},at:function(a){var b=this._list[a];return b?b.value:void 0},add:function(a,b,c){var d=this._map,e=l.call(d,a)&&d[a];return e?e.value!==b&&(e.value=b):(e=d[a]={key:a,value:b},null==c?this._list.push(e):m.array.insertAt(this._list,c,e)),this},rem:function(a){var b=this._map,c=l.call(b,a)&&b[a];if(c){var d=this._list.indexOf(c);this._list.splice(d,1),delete this._map[a]}return this},clear:function(){return this._list.length&&(this._map={},this._list.length=0),this},keys:function(){return m.ownKeys(this._map)},forEach:function(a,b){return this._list.forEach(function(c){a.call(b,c.value,c.key)})}}),m.html={escape:function(a){return m.string.to(a).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")}},m.type("Query").add({index:-1,item:void 0,next:function(){var a=this,b=a.index;return-2!==b&&(b++,a._next(b)?(a.index=b,!0):(a._finish(),!1))},_next:m.method({isAbstract:!0}),_finish:function(){var a=this;a.index>-2&&(a.next=m.retFalse,a.index=-2,delete a.item)},each:function(a,b){for(var c=this;c.next();)if(a.call(b,c.item,c.index)===!1)return!0;return!1},array:function(){for(var a=[],b=this;b.next();)a.push(b.item);return a},sort:function(a,b){if(a||(a=m.compare),b){var c=a;a=function(a,d){return c(b(a),b(d))}}var d=this.array().sort(a);return new m.ArrayLikeQuery(d)},object:function(a){for(var b=m.get(a,"target")||{},c=m.get(a,"name"),d=m.get(a,"value"),e=m.get(a,"context");this.next();){var f=""+(c?c.call(e,this.item,this.index):this.item);b[f]=d?d.call(e,this.item,this.index):this.item}return b},reduce:function(a){var b,c=0;if(arguments.length<2){if(!this.next())throw new TypeError("Length is 0 and no second argument");b=this.item}else b=arguments[1];for(;this.next();)b=a(b,this.item,this.index),++c;return b},count:function(){for(var a=0;this.next();)a++;return a},first:function(a,b,c){for(;this.next();)if(!a||a.call(b,this.item,this.index)){var d=this.item;return this._finish(),d}return c},last:function(a,b,c){for(var d=c;this.next();)(!a||a.call(b,this.item,this.index))&&(d=this.item);return d},any:function(a,b){for(;this.next();)if(!a||a.call(b,this.item,this.index))return this._finish(),!0;return!1},all:function(a,b){for(;this.next();)if(!a.call(b,this.item,this.index))return this._finish(),!1;return!0},min:function(){for(var a=null;this.next();)(null===a||this.item<a)&&(a=this.item);return a},max:function(){for(var a=null;this.next();)(null===a||this.item>a)&&(a=this.item);return a},range:function(){for(var a=null,b=null;this.next();){var c=this.item;null===a?a=b=c:(a>c&&(a=c),c>b&&(b=c))}return null!=a?{min:a,max:b}:null},multipleIndex:function(a,b){var c={};return this.each(function(d){var e=a?a.call(b,d):d;if(null!=e){var f=m.getOwn(c,e)||(c[e]=[]);f.push(d)}}),c},uniqueIndex:function(a,b){var c={};return this.each(function(d){var e=a?a.call(b,d):d;null==e||l.call(c,e)||(c[e]=d)}),c},select:function(a,b){return new m.SelectQuery(this,a,b)},prop:function(a){return new m.SelectQuery(this,function(b){return b?b[a]:void 0})},selectMany:function(a,b){return new m.SelectManyQuery(this,a,b)},union:function(){var a=m.array.append([this],arguments);return new m.SelectManyQuery(new m.ArrayLikeQuery(a))},where:function(a,b){return new m.WhereQuery(this,a,b)},distinct:function(a,b){return new m.DistinctQuery(this,a,b)},skip:function(a){return new m.SkipQuery(this,a)},take:function(a){return 0>=a?new m.NullQuery:isFinite(a)?new m.TakeQuery(this,a):this},whayl:function(a,b){return new m.WhileQuery(this,a,b)},reverse:function(){return new m.ReverseQuery(this)}}),m.type("NullQuery",m.Query).add({next:m.retFalse}),m.type("AdhocQuery",m.Query).init(function(a){this._next=a}),m.type("ArrayLikeQuery",m.Query).init(function(a){function b(){for(;++d<e;)if(l.call(a,d))return c.index=d,c.item=a[d],!0;return c._finish(),!1}var c=this;m.array.isLike(a)||(a=[a]),c._list=a,c._count=a.length;var d=-1,e=a.length;c.next=b}).add({count:function(){var a=this._count;return this.index>=0&&(a-=this.index+1),this._finish(),a}}),m.type("RangeQuery",m.Query).init(function(a,b,c){this._index=a,this._count=b,this._step=null==c?1:c}).add({_next:function(a){if(a<this._count)return this.item=this._index,this._index+=this._step,!0},count:function(){var a=this._count;return this.index>=0&&(a-=this.index+1),this._finish(),a}}),m.type("WhereQuery",m.Query).init(function(a,b,c){function d(){for(;a.next();){var d=a.item;if(b.call(c,d,a.index))return e.item=d,e.index=++f,!0}return e._finish(),!1}var e=this,f=-1;e.next=d}),m.type("WhileQuery",m.Query).init(function(a,b,c){function d(){if(a.next()){var d=a.item;if(b.call(c,d,a.index))return e.item=d,e.index=++f,!0}return e._finish(),!1}var e=this,f=-1;e.next=d}),m.type("SelectQuery",m.Query).init(function(a,b,c){function d(){return a.next()?(e.item=b.call(c,a.item,a.index),e.index=++f,!0):(e._finish(),!1)}var e=this,f=-1;e.next=d}),m.type("SelectManyQuery",m.Query).init(function(a,b,c){this._selectMany=b,this._ctx=c,this._source=a,this._manySource=null}).add({_next:function(){for(;;){if(this._manySource){if(this._manySource.next())return this.item=this._manySource.item,!0;this._manySource=null}if(!j.call(this))break}}}),m.type("DistinctQuery",m.Query).init(function(a,b,c){function d(){for(;a.next();){var d=a.item,h=b?b.call(c,d,a.index):d;if(null!=h&&!l.call(g,h))return e.item=d,e.index=++f,g[h]=!0}return e._finish(),!1}var e=this,f=-1,g={};e.next=d}),m.type("SkipQuery",m.Query).init(function(a,b){this._source=a,this._skip=b}).add({_next:function(){for(;this._source.next();){if(!(this._skip>0))return this.item=this._source.item,!0;this._skip--}}}),m.type("TakeQuery",m.Query).init(function(a,b){this._source=a,this._take=b}).add({_next:function(){if(this._take>0&&this._source.next())return this._take--,this.item=this._source.item,!0}}),m.type("ReverseQuery",m.Query).init(function(a){this._source=a}).add({_next:function(a){a||(this._source instanceof m.Query&&(this._source=this._source instanceof m.ArrayLikeQuery?this._source._list:this._source.array()),this._count=this._source.length);var b=this._count;if(b>a){for(var c=b-a-1,d=this._source;!l.call(d,c);){if(--c<0)return!1;this._count--}return this.item=d[c],!0}}}),m.query=function(a){return void 0===a?new m.NullQuery:a instanceof m.Query?a:m.fun.is(a)?new m.AdhocQuery(a):new m.ArrayLikeQuery(a)},m.range=function(a,b,c){return new m.RangeQuery(a,b,c)},p=m.global,m}();