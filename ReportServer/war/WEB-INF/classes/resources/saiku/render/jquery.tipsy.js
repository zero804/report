/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */

/*!
 * tipsy, facebook style tooltips for jquery
 * version 1.0.0a
 * (c) 2008-2010 jason frame [jason@onehackoranother.com]
 * released under the MIT license
 */

!function(a){function b(a){var b=a.attr("title");(b||"string"!=typeof a.attr("original-title"))&&a.attr("original-title",b||"").removeAttr("title")}function c(c,d){this.$element=a(c),this.options=d,this.enabled=!0,b(this.$element)}c.prototype={enter:function(){var a=this,b=this.options;0==b.delayIn?(a.hoverState=null,a.show()):(a.hoverState="in",setTimeout(function(){"in"===a.hoverState&&(a.hoverState=null,a.show())},b.delayIn))},leave:function(){var a=this,b=this.options;0==b.delayOut?a.hide():(a.hoverState="out",setTimeout(function(){"out"===a.hoverState&&a.hide()},b.delayOut))},visible:function(){var a;return"in"===this.hoverState||"out"!==this.hoverState&&!(!this.$tip||!(a=this.$tip[0].parentNode)||11===a.nodeType)},update:function(){this.visible()?this.show(!0):this.enter()},show:function(b){function c(a){var b;switch(a.charAt(0)){case"n":b={top:g.top+g.height+i,left:g.left+g.width/2-l/2};break;case"s":b={top:g.top-m-i,left:g.left+g.width/2-l/2};break;case"e":b={top:g.top+g.height/2-m/2,left:g.left-l-i};break;case"w":b={top:g.top+g.height/2-m/2,left:g.left+g.width+i}}return 2===a.length&&(b.left="w"==a.charAt(1)?j?g.left+g.width+i:g.left+g.width/2-15:j?g.left-l-i:g.left+g.width/2-l+15),b}if("in"!==this.hoverState){var d=this.getTitle();if(this.enabled&&d){var e=this.tip();e.find(".tipsy-inner")[this.options.html?"html":"text"](d),e[0].className="tipsy",b||e.remove();var f=e[0].parentNode;f&&11!==f.nodeType||e.css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var g=a.extend({},this.$element.offset());if(this.$element[0].nearestViewportElement){var h=this.$element[0].getBoundingClientRect();g.width=h.width,g.height=h.height}else g.width=this.$element[0].offsetWidth||0,g.height=this.$element[0].offsetHeight||0;var i=this.options.offset,j=this.options.useCorners,k=this.options.arrowVisible,l=e[0].offsetWidth,m=e[0].offsetHeight;k||(i-=4);var n="function"==typeof this.options.gravity?this.options.gravity.call(this.$element[0],{width:l,height:m},c):this.options.gravity,o=c(n);if(e.css(o).addClass("tipsy-"+n+(j&&n.length>1?n.charAt(1):"")),k){var p=j&&2===n.length;e.find(".tipsy-arrow")[p?"hide":"show"]()}var q=this.options.fade&&(!b||!this._prevGravity||this._prevGravity!==n);q?e.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):e.css({visibility:"visible",opacity:this.options.opacity}),this._prevGravity=n,this.hoverState=null}else this.hoverState=null,this.hide()}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):this.$tip&&this.tip().remove(),this.hoverState=null},setTitle:function(a){a=null==a?"":""+a,this.$element.attr("original-title",a).removeAttr("title")},getTitle:function(){var a,c=this.$element,d=this.options;return b(c),"string"==typeof d.title?a=c.attr("title"==d.title?"original-title":d.title):"function"==typeof d.title&&(a=d.title.call(c[0])),a=(""+a).replace(/(^\s*|\s*$)/,""),a||d.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>'),this.$tip.html(this.options.arrowVisible?'<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>':'<div class="tipsy-inner"/></div>'),this.$tip.remove()),this.$tip},validate:function(){var a=this.$element[0].parentNode;a&&11!==a.nodeType||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},a.fn.tipsy=function(b,d){function e(d){var e=a.data(d,"tipsy");return e||(e=new c(d,a.fn.tipsy.elementOptions(d,b)),a.data(d,"tipsy",e)),e}function f(){e(this).enter()}function g(){e(this).leave()}if(b===!0)return this.data("tipsy");if("string"==typeof b)return this.data("tipsy")[b](d);if(b=a.extend({},a.fn.tipsy.defaults,b),null==b.arrowVisible&&(b.arrowVisible=!b.useCorners),b.live||this.each(function(){e(this)}),"manual"!=b.trigger){var h=b.live?"live":"bind",i="hover"==b.trigger?"mouseenter":"focus",j="hover"==b.trigger?"mouseleave":"blur";this[h](i,f)[h](j,g)}return this},a.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover",useCorners:!1,arrowVisible:null},a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"}}(jQuery);