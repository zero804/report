/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */

/*!
 * Protovis MSIE/VML addon
 * Copyright (C) 2011 by DataMarket <http://datamarket.com>
 * Dual licensed under the terms of the MIT or GPL Version 2 software licenses.
 * 
 * This software includes code from jQuery, http://jquery.com/
 * jQuery is licensed under the MIT or GPL Version 2 license.
 * 
 * This software includes code from the Protovis, http://mbostock.github.com/protovis/
 * Protovis is licensed under the BSD license.
 * 
 */
pv.have_SVG=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),pv.have_VML=function(a,b,c){return b=a.createElement("div"),b.innerHTML='<pvml:shape adj="1" />',c=b.firstChild,c.style.behavior="url(#default#VML)",!c||"object"==typeof c.adj}(document),!pv.have_SVG&&pv.have_VML&&!function(){"function"!=typeof Date.now&&(Date.now=function(){return 1*new Date});var a={is64Bit:"x64"===window.navigator.cpuClass,round:function(a){return Math.round(21.6*(a||0))},styles:null,pre:"<pvml:",post:' class="msvml">',block:{group:1,shape:1,shapetype:1,line:1,polyline:1,curve:1,rect:1,roundrect:1,oval:1,arc:1,image:1},caps:{butt:"flat",round:"round",square:"square"},joins:{bevel:"bevel",round:"round",miter:"miter"},cursorstyles:{hand:"pointer",crosshair:1,pointer:1,move:1,text:1,wait:1,help:1,progress:1,"n-resize":1,"ne-resize":1,"nw-resize":1,"s-resize":1,"se-resize":1,"sw-resize":1,"e-resize":1,"w-resize":1},text_shim:null,text_dims:function(b,c){var d=a.text_shim||(a.init(),a.text_shim);return d.style.font=a.processFont(c),d.innerText=b,{height:d.offsetHeight,width:d.offsetWidth}},_fontCache:{},_fontSubst:{default:"Arial","sans-serif":"Arial",sansserif:"Arial",sans:"Arial",serif:"Times New Roman",dialog:"Arial",monospaced:"Courier New",dialoginput:"Courier New"},_fontWhiteListIE64Bit:{"agency fb":1,aharoni:1,algerian:1,andalus:1,"angsana new":1,angsanaupc:1,aparajita:1,"arabic typesetting":1,arial:1,"arial black":1,"arial narrow":1,"arial rounded mt bold":1,"arial unicode ms":1,"baskerville old face":1,batang:1,batangche:1,"bauhaus 93":1,"bell mt":1,"berlin sans fb":1,"berlin sans fb demi":1,"bernard mt condensed":1,"blackadder itc":1,"bodoni mt":1,"bodoni mt black":1,"bodoni mt condensed":1,"bodoni mt poster compressed":1,"book antiqua":1,"bookman old style":1,"bookshelf symbol 7":1,"bradley hand itc":1,"britannic bold":1,broadway:1,"browallia new":1,browalliaupc:1,"brush script mt":1,calibri:1,"californian fb":1,"calisto mt":1,cambria:1,"cambria math":1,candara:1,castellar:1,centaur:1,century:1,"century gothic":1,"century schoolbook":1,chiller:1,"colonna mt":1,"comic sans ms":1,consolas:1,constantia:1,"cooper black":1,"copperplate gothic bold":1,"copperplate gothic light":1,corbel:1,"cordia new":1,cordiaupc:1,"courier new":1,"curlz mt":1,daunpenh:1,david:1,"dfkai-sb":1,dilleniaupc:1,dokchampa:1,dotum:1,dotumche:1,ebrima:1,"edwardian script itc":1,elephant:1,"engravers mt":1,"eras bold itc":1,"eras demi itc":1,"eras light itc":1,"eras medium itc":1,"estrangelo edessa":1,eucrosiaupc:1,euphemia:1,fangsong:1,"felix titling":1,"footlight mt light":1,forte:1,"franklin gothic book":1,"franklin gothic demi":1,"franklin gothic demi cond":1,"franklin gothic heavy":1,"franklin gothic medium":1,"franklin gothic medium cond":1,frankruehl:1,freesiaupc:1,"freestyle script":1,"french script mt":1,gabriola:1,garamond:1,gautami:1,georgia:1,gigi:1,"gill sans mt":1,"gill sans mt condensed":1,"gill sans mt ext condensed bold":1,"gill sans ultra bold":1,"gill sans ultra bold condensed":1,gisha:1,"gloucester mt extra condensed":1,"goudy old style":1,"goudy stout":1,gulim:1,gulimche:1,gungsuh:1,gungsuhche:1,"guttman adii":1,"guttman adii-light":1,"guttman aharoni":1,"guttman calligraphic":1,"guttman david":1,"guttman drogolin":1,"guttman frank":1,"guttman frnew":1,"guttman haim":1,"guttman haim-condensed":1,"guttman hatzvi":1,"guttman hodes":1,"guttman kav":1,"guttman kav-light":1,"guttman keren":1,"guttman logo1":1,"guttman mantova":1,"guttman mantova-decor":1,"guttman miryam":1,"guttman myamfix":1,"guttman rashi":1,"guttman stam":1,"guttman stam1":1,"guttman vilna":1,"guttman yad":1,"guttman yad-brush":1,"guttman yad-light":1,"guttman-aharoni":1,"guttman-aram":1,"guttman-courmir":1,"guttman-soncino":1,"guttman-toledo":1,haettenschweiler:1,"harlow solid italic":1,harrington:1,"high tower text":1,impact:1,"imprint mt shadow":1,"informal roman":1,irisupc:1,"iskoola pota":1,jasmineupc:1,jokerman:1,"juice itc":1,kaiti:1,kalinga:1,kartika:1,"khmer ui":1,kodchiangupc:1,kokila:1,"kristen itc":1,"kunstler script":1,"lao ui":1,latha:1,leelawadee:1,"levenim mt":1,lilyupc:1,"lucida bright":1,"lucida calligraphy":1,"lucida console":1,"lucida fax":1,"lucida handwriting":1,"lucida sans":1,"lucida sans typewriter":1,"lucida sans unicode":1,magneto:1,"maiandra gd":1,"malgun gothic":1,mangal:1,marlett:1,"matura mt script capitals":1,meiryo:1,"meiryo ui":1,"microsoft himalaya":1,"microsoft jhenghei":1,"microsoft new tai lue":1,"microsoft phagspa":1,"microsoft sans serif":1,"microsoft tai le":1,"microsoft uighur":1,"microsoft yahei":1,"microsoft yi baiti":1,mingliu:1,"mingliu-extb":1,mingliu_hkscs:1,"mingliu_hkscs-extb":1,miriam:1,"miriam fixed":1,mistral:1,"modern no. 20":1,"mongolian baiti":1,"monotype corsiva":1,"monotype hadassah":1,moolboran:1,"ms gothic":1,"ms mincho":1,"ms outlook":1,"ms pgothic":1,"ms pmincho":1,"ms reference sans serif":1,"ms reference specialty":1,"ms ui gothic":1,"mt extra":1,"mv boli":1,narkisim:1,"niagara engraved":1,"niagara solid":1,nsimsun:1,nyala:1,"ocr a extended":1,"old english text mt":1,onyx:1,"palace script mt":1,"palatino linotype":1,papyrus:1,parchment:1,perpetua:1,"perpetua titling mt":1,"plantagenet cherokee":1,playbill:1,pmingliu:1,"pmingliu-extb":1,"poor richard":1,pristina:1,raavi:1,"rage italic":1,ravie:1,rockwell:1,"rockwell condensed":1,"rockwell extra bold":1,rod:1,"sakkal majalla":1,"script mt bold":1,"segoe print":1,"segoe script":1,"segoe ui":1,"segoe ui light":1,"segoe ui semibold":1,"segoe ui symbol":1,"shonar bangla":1,"showcard gothic":1,shruti:1,simhei:1,"simplified arabic":1,"simplified arabic fixed":1,simsun:1,"simsun-extb":1,"snap itc":1,stencil:1,sylfaen:1,symbol:1,tahoma:1,"tempus sans itc":1,"times new roman":1,"toptype soncino":1,"traditional arabic":1,"trebuchet ms":1,tunga:1,"tw cen mt":1,"tw cen mt condensed":1,"tw cen mt condensed extra bold":1,utsaah:1,vani:1,verdana:1,vijaya:1,"viner hand itc":1,vivaldi:1,"vladimir script":1,vrinda:1,webdings:1,"wide latin":1,wingdings:1,"wingdings 2":1,"wingdings 3":1},_defaultFontIE64Bit:"Arial",processFont:function(b){var c=a._fontCache[b];if(!c){var d=a.text_shim||(a.init(),a.text_shim),e=d.style;e.font=b;var f=e.fontFamily;'"'===f.charAt(0)&&(f=f.substr(1,f.length-1));var g=f.toLowerCase(),h=a._fontSubst[g];h?f=h:a.is64Bit&&!a._fontWhiteListIE64Bit[g]&&(f=a._defaultFontIE64Bit),e.fontFamily='"'+f+'"',a._fontCache[b]=c=e.font}return c},get_dim:function(a,b){var c=b||{};c.rotation=c.tx=c.ty=0,c.sx=c.sy=1;var d=a.transform;if(d){var e=/translate\((-?\d+(?:\.\d+)?(?:e-?\d+)?)(?:,(-?\d+(?:\.\d+)?(?:e-?\d+)?))?\)/.exec(d);e&&(e[1]&&(c.tx=+e[1]),e[2]&&(c.ty=+e[2]));var f=/rotate\((-?\d+(?:\.\d+)?(?:e-?\d+)?)\)/.exec(d);if(f){var f=+f[1]%360;0>f&&(f+=360),f=pv.radians(f)}var g=/scale\((-?\d+(?:\.\d+)?(?:e-?\d+)?)(?:,(-?\d+(?:\.\d+)?(?:e-?\d+)?))?\)/.exec(d);g&&(g[1]&&(c.sx=+g[1]),g[2]&&(c.sy=+g[2])),c.rotation=f||0}return c.x=parseFloat(a.x||0),c.y=parseFloat(a.y||0),"width"in a&&(c.width=parseFloat(a.width)),"height"in a&&(c.height=parseFloat(a.height)),c},solidFillStyle:{type:"solid"},elm_defaults:{g:{rewrite:"span",attr:function(b,c,d){var e=a.get_dim(b);d.style.cssText="position:absolute;zoom:1;left:"+(e.tx+e.x)+"px;top:"+(e.ty+e.y)+"px;"}},line:{rewrite:"shape",attr:function(b,c,d,e,f){var g=parseFloat(b.x1||0),h=parseFloat(b.y1||0),i=parseFloat(b.x2||0),j=parseFloat(b.y2||0),k=a.round;d.coordorigin="0,0",d.coordsize="21600,21600",a.path(d).v="M "+k(g)+" "+k(h)+" L "+k(i)+" "+k(j)+" E",a.stroke(d,b,e,f)},css:"top:0px;left:0px;width:1000px;height:1000px"},rect:{rewrite:"shape",attr:function(b,c,d,e,f){var g=a.get_dim(b),h=a.path(d),i=a.round;d.coordorigin="0,0",d.coordsize="21600,21600";var j=i(g.tx+g.x),k=i(g.ty+g.y),l=i(g.width),m=i(g.height);h.v="M "+j+" "+k+" L "+(j+l)+" "+k+" L "+(j+l)+" "+(k+m)+" L "+j+" "+(k+m)+" x",a.stroke(d,b,e,f),a.fill(d,b,e,f)},css:"top:0px;left:0px;width:1000px;height:1000px"},path:{rewrite:"shape",attr:function(b,c,d,e,f){var g=a.get_dim(b),h=d.style;h.visibility="hidden",h.left=g.tx+g.x+"px",h.top=g.ty+g.y+"px",d.coordorigin="0,0",d.coordsize="21600,21600",d._events=b["pointer-events"]||"none",a.path(d,b.d);var i=a.rotateAndScale(d,g.rotation&&-g.rotation,g.sx,g.sy);i&&(i.origin="-0.5,-0.5"),a.fill(d,b,e,f),a.stroke(d,b,e,f),h.visibility="visible"},css:"top:0px;left:0px;width:1000px;height:1000px;"},ellipse:{rewrite:"oval",attr:function(b,c,d,e,f){var g=a.get_dim(b),h=b.rx,i=b.ry,j=d.style;j.left=g.tx-h+"px",j.top=g.ty-i+"px",j.width=2*h+"px",j.height=2*i+"px";var k=a.rotateAndScale(d,g.rotation&&-g.rotation);k&&(k.origin="0,0"),a.fill(d,b,e,f),a.stroke(d,b,e,f)}},circle:{rewrite:"oval",attr:function(b,c,d,e,f){var g=a.get_dim(b),h=parseFloat(b.r||0)+.5,i=parseFloat(b.cx||0)+.7,j=parseFloat(b.cy||0)+.7,k=d.style;k.left=g.tx+i-h+"px",k.top=g.ty+j-h+"px",k.width=k.height=2*h+"px",a.fill(d,b,e,f),a.stroke(d,b,e,f)}},text:{rewrite:"shape",attr:function(b,c,d,e,f){d.style,d.stroked="False",d.path="m0,0 l1,0 e";var g=a.textpath(d);g.string=b.string;var h=g.style;h["v-text-align"]=b.textAlign,h.font=b.font,b.textDecoration&&(h.textDecoration=b.textDecoration),a.path(d).textpathok="True",a.rotateAndScale(d,b.rotation&&-b.rotation);var i=e[f];i.fillStyle=a.solidFillStyle,a.fill(d,b,e,f),i.fillStyle=null},css:"position:absolute;top:0px;left:0px;width:1px;height:1px;"},svg:{rewrite:"span",css:"position:relative;overflow:hidden;display:inline-block;"},"vml:path":{rewrite:"path"},"vml:stroke":{rewrite:"stroke"},"vml:fill":{rewrite:"fill"},"vml:textpath":{rewrite:"textpath"},"vml:skew":{rewrite:"skew"}},_elmcache:{span:document.createElement("span"),div:document.createElement("div")},createElement:function(b){var c,d=a._elmcache,e=a.elm_defaults[b]||{},f=e.rewrite||b;return f in d?c=d[f].cloneNode(!1):(d[f]=document.createElement(a.pre+f+a.post),f in a.block&&(d[f].className+=" msvml_block"),c=d[f].cloneNode(!1)),e.css&&(c.style.cssText=e.css),c},_hex:pv.range(0,256).map(function(a){return pv.Format.pad("0",2,a.toString(16))}),_colorcache:{},color:function(b){var c,d=a._colorcache[b];return!d&&(c=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(b))&&(a._colorcache[b]=d="#"+a._hex[c[1]]+a._hex[c[2]]+a._hex[c[3]]),d||b},fill:function(b,c,d,e){var f=b.getElementsByTagName("fill")[0]||(f=b.appendChild(a.createElement("vml:fill"))),g=d[e].fillStyle,h=g&&g.type;if(h||(h="solid"),!c.fill||!g||"solid"===h&&"none"===c.fill)f.on="false";else{if(f.on="true","solid"===h)f.type="solid",f.color=a.color(c.fill);else{var i="lineargradient"===h;f.method="none";var j=g.stops,k=j.length;if(k>0){for(var l=[],e=0;k>e;e++){var m=j[e];l.push(m.offset+"% "+a.color(m.color.color))}f.colors&&"object"==typeof f.colors?f.colors.value=l.join(","):f.colors=l.join(",")}if(i){f.type="gradient";var n=-pv.degrees(g.angle)%360;f.angle=0>n?n+360:n}else f.type="gradientTitle",f.focus="100%",f.focussize="0 0",f.focusposition="0 0",f.angle=0}f.opacity=Math.min(parseFloat(c["fill-opacity"]||"1"),1)||"1"}},stroke:function(b,c){var d=b.getElementsByTagName("stroke")[0]||(d=b.appendChild(a.createElement("vml:stroke")));if(c.stroke&&"none"!==c.stroke){var e=c["stroke-width"];if(e=null==e||""===e?1:+e,1e-10>e?e=0:1>e&&(e=1),e){d.on="true",d.weight=e,d.color=a.color(c.stroke)||"black",d.opacity=Math.min(parseFloat(c["stroke-opacity"]||"1"),1)||"1",d.joinstyle=a.joins[c["stroke-linejoin"]]||"miter",d.miterlimit=c["stroke-miterlimit"]||8,d.endcap=a.caps[c["stroke-linecap"]]||"flat";var f=c["stroke-dasharray"];f&&"none"!==f||(f="Solid"),d.dashstyle=f}else d.on="false",d.weight=0}else d.on="false",d.weight=0},path:function(b,c){var d=b.getElementsByTagName("path")[0]||(d=b.appendChild(a.createElement("vml:path")));return arguments.length>1&&(d.v=a.rewritePath(c)),d},skew:function(b){var c=b.getElementsByTagName("skew")[0]||(c=b.appendChild(a.createElement("vml:skew")));return c.on="false",c},rotateAndScale:function(b,c,d,e){c&&(c=pv.radians(Math.round(pv.degrees(c))%360));var f=d&&1!==d||e&&1!==e;if(c||f){var g=a.skew(b);g.on="true",g.offset="0,0",d||(d=1),e||(e=1);var h;if(c){var i=Math.cos(c),j=Math.sin(c);h=(d*i).toFixed(8)+","+(e*j).toFixed(8)+","+(d*-j).toFixed(8)+","+(e*i).toFixed(8)+",0,0"}else h=d.toFixed(8)+",0,0,"+e.toFixed(8)+",0,0";return g.matrix=h,g}},textpath:function(b){var c=b.getElementsByTagName("textpath")[0]||(c=b.appendChild(a.createElement("vml:textpath")));return c.style["v-text-align"]="center",c.style["v-text-kern"]="true",c.on="true",c},init:function(){if(a.text_shim||(a.text_shim=document.getElementById("pv_vml_text_shim")||document.createElement("span"),a.text_shim.id="protovisvml_text_shim",a.text_shim.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline-block;white-space:nowrap;",document.body.appendChild(a.text_shim)),!a.styles){a.styles=document.getElementById("protovisvml_styles")||document.createElement("style"),a.styles.id="protovisvml_styles",document.documentElement.firstChild.appendChild(a.styles),a.styles.styleSheet.addRule(".msvml","behavior:url(#default#VML);"),a.styles.styleSheet.addRule(".msvml_block","position:absolute;top:0;left:0;");try{document.namespaces.pvml||document.namespaces.add("pvml","urn:schemas-microsoft-com:vml")}catch(b){a.pre="<",a.post=' class="msvml" xmlns="urn:schemas-microsoft.com:vml">'}}},_pathcache:{},rewritePath:function(b){var c=0,d=0,e=a.round;if(!b)return b;if(b in a._pathcache)return a._pathcache[b];b=b.replace(/(\d*)((\.*\d*)(e ?-?\d*))/g,"$1");for(var f=b.match(/([MLHVCSQTAZ ][^MLHVCSQTAZ ]*)/gi),g=[],h=[],i="",j=0,k=f.length;k>j;j++){var l=f[j],m=l.charAt(0),n=l.substring(1).split(/[,]/);switch(" "==m&&(m=i),i=m,m){case"M":m="m",c=e(n[0]),d=e(n[1]),n=[c,d];break;case"m":m="m",c+=e(n[0]),d+=e(n[1]),n=[c,d];break;case"A":m="l",n=[c=e(n[5]),d=e(n[6])];break;case"L":m="l",n=[c=e(n[0]),d=e(n[1])];break;case"l":m="l",n=[c+=e(n[0]),d+=e(n[1])];break;case"H":m="l",n=[c=e(n[0]),d];break;case"h":m="l",n=[c+=e(n[0]),d];break;case"V":m="l",n=[c,d=e(n[0])];break;case"v":m="l",n=[c,d+=e(n[0])];break;case"C":m="c",h=n=[e(n[0]),e(n[1]),e(n[2]),e(n[3]),c=e(n[4]),d=e(n[5])];break;case"c":m="c",h=n=[c+e(n[0]),d+e(n[1]),c+e(n[2]),d+e(n[3]),c+=e(n[4]),d+=e(n[5])];break;case"S":m="c",h=n=[h[4]+(h[4]-h[2]),h[5]+(h[5]-h[3]),e(n[0]),e(n[1]),c=e(n[2]),d=e(n[3])];break;case"s":m="c",h=n=[h[4]+(h[4]-h[2]),h[5]+(h[5]-h[3]),c+e(n[0]),d+e(n[1]),c+=e(n[2]),d+=e(n[3])];break;case"Q":m="c";var o=e(n[0]),p=e(n[1]),q=e(n[2]),r=e(n[3]);n=[~~(c+2*(o-c)/3),~~(d+2*(p-d)/3),~~(o+(q-o)/3),~~(p+(r-p)/3),c=q,d=r];break;case"q":m="l",c+=e(n[2]),d+=e(n[3]),n=[c,d];break;case"Z":case"z":m="xe",n=[];break;default:m="",n=[]}g.push(m,n.join(","))}return a._pathcache[b]=g.join("")+"e"}};pv.Text.measure=a.text_dims,pv.Vml=a,pv.VmlScene={scale:1,events:["mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick","contextmenu"],mousePositionEventSet:pv.Scene.mousePositionEventSet,eventsToNumber:pv.Scene.eventsToNumber,numberToEvents:pv.Scene.numberToEvents,implicit:{css:{}},copy_functions:function(a){for(var b in a)"function"!=typeof a[b]||b in pv.VmlScene||(pv.VmlScene[b]=a[b])}},pv.VmlScene.copy_functions(pv.SvgScene),pv.Scene=pv.VmlScene,pv.renderer=function(){return"vml"},!function(a){pv.VmlScene.minRuleLineWidth=a?1.2:1.1,pv.VmlScene.minBarWidth=a?2.2:1.8,pv.VmlScene.minBarHeight=a?2.2:1.8,pv.VmlScene.minBarLineWidth=a?1.2:1}(a.is64Bit),pv.VmlScene.expect=function(b,c,d,e,f,g){g=g||{};var h=a.elm_defaults[c]||{},i=h.rewrite||c;if(b){if(b.tagName.toUpperCase()!==i.toUpperCase()){var j=a.createElement(c);b.parentNode.replaceChild(j,b),b=j}}else b=a.createElement(c);if(f&&("attr"in h&&h.attr(f,g,b,d,e),f.cursor in a.cursorstyles)){var k=a.cursorstyles[f.cursor];g.cursor=1===k?f.cursor:k}return g&&this.setStyle(b,g),b},pv.VmlScene.removeSiblings=function(a){for(;a;){var b=a.nextSibling;a.parentNode.removeChild(a),a=b}},pv.VmlScene.addFillStyleDefinition=function(){},pv.VmlScene.setAttributes=function(){},pv.VmlScene.setStyle=function(a,b){var c=a.__style__;c===b&&(c=null);var d=a.style;for(var e in b){var f=b[e];c&&f===c[e]||(null==f?d.removeAttribute(e):d[e]=f)}a.__style__=b},pv.VmlScene.append=function(a,b,c){return a.$scene={scenes:b,index:c},a=this.title(a,b[c]),a.parentNode&&11!==a.parentNode.nodeType||b.$g.appendChild(a),a.nextSibling},pv.VmlScene.title=function(a,b){return a.title=b.title||"",a},pv.VmlScene.panel=function(b){for(var c,d=b.$g,e=d&&d.firstChild,f=!1,g=0,h=b.length;h>g;g++){var i=b[g];if(i.visible){if(!b.parent){var j=i.canvas;if(c=j.style,c.display="inline-block",c.zoom=1,d&&d.parentNode!==j&&(d=j.firstChild,e=d&&d.firstChild),!d){f=!0,a.init(),d=j.appendChild(a.createElement("svg")),d.unselectable="on",d.onselectstart=function(){return!1};for(var k=this.events,l=this.dispatch,m=0,n=k.length;n>m;m++)d.addEventListener?d.addEventListener(k[m],l,!1):d.attachEvent("on"+k[m],l);e=d.firstChild}b.$g=d;var o=i.width+i.left+i.right,p=i.height+i.top+i.bottom;c=d.style,c.width=o+"px",c.height=p+"px",c.clip="rect(0px "+o+"px "+p+"px 0px)"}var q;"hidden"===i.overflow&&(q=this.expect(e,"g",b,g),q.style.position="absolute",q.style.clip="rect("+i.top.toFixed(2)+"px "+(i.left+i.width).toFixed(2)+"px "+(i.top+i.height).toFixed(2)+"px "+i.left.toFixed(2)+"px)",q.parentNode||d.appendChild(q),b.$g=d=q,e=q.firstChild),e=this.fill(e,b,g);var r=this.scale,s=i.transform,t=i.left+s.x,u=i.top+s.y;if(this.scale*=s.k,i.children.length)for(var v={transform:"translate("+t+","+u+")"+(1!=s.k?" scale("+s.k+")":"")},w=this.getSortedChildScenes(b,g),m=0,x=w.length;x>m;m++){var y=w[m];y.$g=e=this.expect(e,"g",b,g,v),this.updateAll(y);var z=e.parentNode;if(!z||11===z.nodeType){d.appendChild(e);var A=a.elm_defaults[e.svgtype];A&&"function"==typeof A.onappend&&A.onappend(e,b[g])}e=e.nextSibling}this.scale=r,e=this.stroke(e,b,g),q&&(b.$g=d=q.parentNode,e=q.nextSibling)}}return f&&(this.removeSiblings(e),e=d.appendChild(a.createElement("oval"))),e},pv.VmlScene.parseDasharray=function(a){var b=a.strokeDasharray;if(b&&"none"!==b){var c=this.translateDashStyleAlias(b);this.isStandardDashStyle(c)?b=c:(b=b.split(/[\s,]+/).map(function(a){return+a/this.scale},this),b.length%2&&(b=b.concat(b)),b=b.join(" "))}else b=null;return b},pv.VmlScene.create=function(b){return a.createElement(b)},!function(){function b(a){a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=d,(a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault())&&(this.isDefaultPrevented=c),this.timeStamp=a.timeStamp||Date.now()):(this.type=a,this.timeStamp=Date.now())}var c=function(){return!0},d=function(){return!1},e=["altKey","attrChange","attrName","bubbles","button","cancelable","charCode","clientX","clientY","ctrlKey","currentTarget","data","detail","eventPhase","fromElement","handler","keyCode","layerX","layerY","metaKey","newValue","offsetX","offsetY","pageX","pageY","prevValue","relatedNode","relatedTarget","screenX","screenY","shiftKey","srcElement","target","toElement","view","wheelDelta","which"],f=e.length;b.prototype={preventDefault:function(){this.isDefaultPrevented=c;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=c;var a=this.originalEvent;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=c,this.stopPropagation()},isDefaultPrevented:d,isPropagationStopped:d,isImmediatePropagationStopped:d};var g=document.compatMode&&"BackCompat"!=document.compatMode?"documentElement":"body";a.fixEvent=function(a){var c=a;a=new b(c);for(var d=a.type,h="keypress"===d,i=f;i;){var j=e[--i];a[j]=c[j]}var k=a.target;k||(k=a.srcElement||document,3===k.nodeType&&(k=k.parentNode),a.target=k);var l;if(!a.relatedTarget&&(l=a.fromElement)&&(a.relatedTarget=l===k?a.toElement:l),!h){var m;if(null==a.pageX&&null!=(m=a.clientX)){var n=document[g];a.pageX=m+(n.scrollLeft||0)-(n.clientLeft||0),a.pageY=a.clientY+(n.scrollTop||0)-(n.clientTop||0)}}if(null==a.which){var o,p,q;h?null!=(o=a.charCode)?a.which=o:null!=(p=a.keyCode)&&(a.which=p):null!==(q=a.button)&&(a.which=1&q?1:2&q?3:4&q?2:0)}return a.metaKey=!!a.metaKey,"mousewheel"===d&&(a.wheel=a.wheelDelta),a}}(),pv.fixEvent=function(b){return a.fixEvent(b||window.event)},pv.VmlScene.dispatch=pv.listener(function(a){var b=a.target.$scene;if(b){var c=a.target._events;("none"===c||pv.Mark.dispatch(a.type,b.scenes,b.index,a))&&(a.preventDefault(),a.stopPropagation())}}),pv.VmlScene.image=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){if(b=this.fill(b,a,c),d.image);else{b=new Image,b.src=d.url;var e=b.style;e.position="absolute",e.top=d.top,e.left=d.left,e.width=d.width,e.height=d.height,e.cursor=d.cursor,e.msInterpolationMode="bicubic"}b=this.append(b,a,c),b=this.stroke(b,a,c)}}return b},pv.VmlScene.label=function(b){for(var c=b.$g.firstChild,d=0,e=b.length;e>d;d++){var f=b[d];if(f.visible){var g=f.textStyle;if(g.opacity&&f.text){var h=f.text.replace(/\s+/g," "),i=a.processFont(f.font),j=a.text_dims(h,i),k=0,l=0;switch(f.textBaseline){case"middle":l=.1*j.height;break;case"top":l=f.textMargin+.5*j.height;break;case"bottom":l=-(f.textMargin+.5*j.height)}switch(f.textAlign){case"left":k=f.textMargin;break;case"right":k=-f.textMargin}var m=f.textAngle;if(m){var n=Math.cos(m),o=Math.sin(m),p=k*n-l*o,q=k*o+l*n;k=p,l=q}var r=f.left+k,s=f.top+l,t={};f.cursor&&(t.cursor=f.cursor),t.fill=a.color(g.color)||"black",a.is64Bit&&(t["fill-opacity"]=.7),t.x=r,t.y=s,t.rotation=f.textAngle,t.string=h,t.textAlign=f.textAlign,t.font=i,t.textDecoration=f.textDecoration,c=this.expect(c,"text",b,d,t,{display:"block",lineHeight:1,whiteSpace:"nowrap",zoom:1,position:"absolute",cursor:"default",top:s+"px",left:r+"px"}),c=this.append(c,b,d)}}}return c},pv.VmlScene.wedge=function(b){for(var c=b.$g.firstChild,d=a.round,e=0,f=b.length;f>e;e++){var g=b[e];if(g.visible){var h=g.fillStyle,i=g.strokeStyle;if(h.opacity||i.opacity){c=this.expect(c,"path",b,e,{"pointer-events":g.events,cursor:g.cursor,transform:"translate("+g.left+","+g.top+")",d:"",fill:h.color,"fill-rule":"evenodd","fill-opacity":h.opacity||null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?g.lineWidth/this.scale:null,"stroke-linecap":g.lineCap,"stroke-linejoin":g.lineJoin,"stroke-miterlimit":g.strokeMiterLimit,"stroke-dasharray":i.opacity?this.parseDasharray(g):null});var j=c.getElementsByTagName("path")[0];j||(j=a.make("path"),c.appendChild(j));var k,l=d(g.innerRadius),m=d(g.outerRadius);if(g.angle>=2*Math.PI)k=l?"AE0,0 "+m+","+m+" 0 23592960AL0,0 "+l+","+l+" 0 23592960":"AE0,0 "+m+","+m+" 0 23592960";else{var n=Math.round(g.startAngle/Math.PI*11796480),o=Math.round(g.angle/Math.PI*11796480);k=l?"AE 0,0 "+m+","+m+" "+-n+" "+-o+" 0,0 "+l+","+l+" "+-(n+o)+" "+o+"X":"M0,0AE0,0 "+m+","+m+" "+-n+" "+-o+"X"}j.v=k,c=this.append(c,b,e)}}}return c}}();